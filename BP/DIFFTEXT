SUBROUTINE DIFFTEXT( DIFFS, INTEXTA, INTEXTB, TRIMSPACE, IGNORESPACE, IGNORECASE )
    EQU FALSE TO 0
    EQU TRUE TO 1

    IF NOT( ASSIGNED( TRIMSPACE ) ) THEN TRIMSPACE = FALSE
    IF NOT( ASSIGNED( IGNORESPACE ) ) THEN IGNORESPACE = FALSE
    IF NOT( ASSIGNED( IGNORECASE ) ) THEN IGNORECASE = FALSE

    TEXTA = INTEXTA
    TEXTB = INTEXTB
    IF (DCOUNT( TEXTA, @FM ) = 1) THEN TEXTA := @FM
    IF (DCOUNT( TEXTB, @FM ) = 1) THEN TEXTB := @FM
    H = ""
    CALL DIFFCODES( DIFFCODESA, TEXTA, H, TRIMSPACE, IGNORESPACE, IGNORECASE )
    CALL DIFFDATA( DATAA, DIFFCODESA )
    DATAA.LENGTH = DATAA<1>
    CALL DIFFCODES( DIFFCODESB, TEXTB, H, TRIMSPACE, IGNORESPACE, IGNORECASE )
    CALL DIFFDATA( DATAB, DIFFCODESB )
    DATAB.LENGTH = DATAB<1>
    H = ""
    DOWNVECTOR = ""
    UPVECTOR = ""
    CALL LCS( DATAA, 1, DATAA.LENGTH, DATAB, 1, DATAB.LENGTH, DOWNVECTOR, UPVECTOR )
    CALL OPTIMIZE( DATAA )
    CALL OPTIMIZE( DATAB )
    CALL CREATEDIFFS( DIFFS, DATAA, DATAB )

    RETURN

END ;* DIFFTEXT
